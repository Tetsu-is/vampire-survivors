# ゲーム要件書 (SPEC.md)

## 1. ゲームコンセプト

*   **ジャンル**: サバイバルアクション (Vampire Survivorsライク)
*   **視点**: 三人称視点
*   **目標**: 迫りくる敵の大群を倒し、プレイヤーキャラクターを強化しながら生き残る。

## 2. プレイヤーキャラクター

*   **操作**: プレイヤーは三人称視点でキャラクターを操作する。
    *   移動: WASDキーまたは方向キーでの八方向移動。
    *   攻撃: プレイヤーの周囲に自動的に攻撃が発生する (Vampire Survivors方式)。手動での攻撃操作は不要。
*   **成長**:
    *   敵を倒すと経験値を獲得し、レベルアップする。
    *   レベルアップ時には、複数のスキルや武器の選択肢が提示され、プレイヤーが選択してキャラクターを強化する。
    *   選択可能な強化要素:
        *   新しい武器の習得
        *   既存武器の強化 (攻撃力、範囲、頻度など)
        *   パッシブスキル (移動速度、HP回復、防御力など)

### 2.1. 経験値とレベルアップ

*   **経験値の獲得**:
    *   敵を倒すと、敵の種類に応じた経験値を得られるアイテム（経験値オーブ）をドロップする。
    *   プレイヤーが経験値オーブに接触すると、経験値を獲得する。
    *   経験値オーブは一定時間で消滅する。
*   **レベルアップ**:
    *   獲得した経験値が現在のレベルアップに必要な経験値量に達すると、プレイヤーはレベルアップする。
    *   レベルアップに必要な経験値は、レベルが上がるごとに増加する。
    *   レベルアップ時にはゲームが一時停止し、プレイヤーは提示された複数の強化項目の中から1つを選択する。
*   **強化項目の選択**:
    *   レベルアップ時に提示される強化項目は、以下のいずれかを含む。
        *   新しい武器の習得
        *   既存武器の強化
        *   パッシブスキルの習得または強化
    *   選択肢はランダムに提示されるが、既に最大レベルの武器やスキルは提示されない。
*   **レベル**:
    *   プレイヤーの最大レベルは設定しない（無限にレベルアップ可能）。

### 2.2. ダメージと無敵時間

*   **ダメージ**:
    *   敵と接触するとダメージを受け、HPが減少する。
*   **無敵時間**:
    *   ダメージを受けた直後、プレイヤーは3秒間の無敵時間に入る。
    *   無敵時間中は、敵と接触しても追加のダメージを受けない。
    *   無敵時間中、プレイヤーキャラクターは0.5秒間隔で点滅し、視覚的に無敵状態であることを示す。

### 2.3. 初期ステータス

*   **最大HP**: 3

## 3. 敵キャラクター

*   **種類**: 時間経過と共に様々な種類の敵が出現する。
    *   基本的な雑魚敵
    *   中ボス、ボス敵 (特定の時間や条件で出現)
*   **行動**: プレイヤーに向かって移動し、接触することでダメージを与える。
*   **ドロップ**: 敵を倒すと経験値アイテムや回復アイテムなどをドロップする。

### 3.1. 敵の出現ルール

*   **出現場所**: 画面外のランダムな位置に出現し、プレイヤーに向かってくる。
*   **出現頻度**:
    *   ゲーム開始直後: 出現数は少なく、種類も基本的な雑魚敵のみ。
    *   **時間経過**: ゲームの経過時間に応じて、敵の出現頻度、出現数、種類の多様性が増加する。
    *   **特定の時間**: 1分ごとなど、特定のゲーム時間ごとに、より強力な敵（または大量の雑魚敵）が出現するウェーブが発生する。
*   **敵の種類**:
    *   **雑魚敵**: HPが低く、移動速度も遅いが、数が多くプレイヤーを囲もうとする。
    *   **中型敵**: 雑魚敵よりHPが高く、移動速度も速い。
    *   **ボス敵**: HPが非常に高く、特殊な攻撃パターンを持つ場合がある。特定の時間経過で出現。

### 3.2. 敵とプレイヤー、銃弾のインタラクション

*   **銃弾と敵の衝突判定**:
    *   銃弾が敵に接触した場合、銃弾は消滅し、敵にダメージを与える。
    *   敵のHPが0になった場合、敵は消滅し、経験値アイテムをドロップする。
*   **プレイヤーと敵の衝突判定**:
    *   プレイヤーが敵に接触した場合、プレイヤーはダメージを受けHPが減少し、無敵状態に入る (詳細は 2.2 を参照)。
*   **敵の消滅**:
    *   HPが0になった敵は、画面上から消滅する。
    *   銃弾によって倒された場合、即座に消滅する。

## 4. 武器とスキル

*   **武器**:
    *   自動攻撃が基本。
    *   複数の武器を同時に所持・強化可能。
    *   武器ごとに異なる攻撃範囲、攻撃頻度、エフェクトを持つ。
    *   **自動追尾弾**:
        *   **ターゲット**: プレイヤーに最も近い敵を自動的に追尾する。
        *   **弾速**: 通常の弾よりも遅い。
        *   **追尾性能**: 追尾強度のパラメータを持ち、軌道修正の大きさを調整可能にする。
        *   **ターゲットの再設定**: 追尾中の敵が倒された場合、次に最も近い敵を新たなターゲットとして設定する。
*   **貫通弾 (Piercing Shot)**
    *   **効果**: プレイヤーの手動攻撃から発射される弾丸が敵を貫通するようになる。
    *   **貫通回数**: 初期レベルでは1体の敵を貫通し、2体目以降にダメージを与える。アビリティのレベルが上がることで、貫通できる敵の数が増加する。
    *   **ダメージ減衰**: 弾丸が敵を貫通するたびに、次の敵に与えるダメージが減少する（例: 最初の敵には100%ダメージ、2体目には80%、3体目には60%など）。減衰率はアビリティのレベルやゲームバランスに応じて調整する。
*   **スキル**:
    *   **パッシブスキル**
        *   **最大HPアップ**: プレイヤーの最大HPが1増加する。
        *   **移動速度アップ**: プレイヤーの移動速度が少し上昇する。
        *   **弾速アップ**: 銃弾の速度が上昇する。
        *   **弾の攻撃力アップ**: 銃弾の攻撃力が上昇する。
    *   HP上限アップ
    *   回復量アップ
    *   防御力アップ
    *   経験値獲得量アップ
    *   磁力 (アイテム引き寄せ範囲) アップ
*   **サモン（ゴースト）**
    *   **入手方法**: レベルアップ時のアビリティロールで獲得。
    *   **効果**: プレイヤーに追従する子分のゴーストを召喚する。
    *   **数**: 常に1体のゴーストを召喚する。
    *   **行動**: プレイヤーキャラクターの周囲を一定距離で追従する。範囲内に敵が入ると自動で対象を攻撃する。
    *   **ステータス**:
        *   HPの概念はない（敵の攻撃で倒されることはない）。
        *   攻撃力はプレイヤーの弾丸ダメージの50%が初期値となる。その後、**プレイヤーのレベルが1上がるごとに、ゴーストの攻撃力は1.1倍に強化される。**
        *   攻撃レートは固有の値を持ち、レベルアップで向上する可能性がある。
    *   **見た目**: 小さなゴースト（8x8ピクセル程度の白色の半透明な幽霊のような表現）。

## 5. UI (ユーザーインターフェース)

*   **HUD**:
    *   HPバー
    *   経験値バー
    *   タイマー (プレイ時間)
        *   経過時間をMM:SS形式で表示する。
    *   所持武器/スキルアイコン
*   **レベルアップ画面**:
    *   選択可能な強化内容を表示し、プレイヤーが選択。

### 5.1. 照準と攻撃

*   **照準**: マウスカーソルの位置に十字マークを表示する。
*   **攻撃操作**:
    *   プレイヤーの手動攻撃は、マウスカーソルで指定した方向にスペースキーで銃弾を発射する。
    *   銃弾はプレイヤーの現在位置から発射され、照準の方向へ直進する。
    *   **弾丸の発射レート**:
        *   プレイヤーの手動攻撃（スペースキー）は、長押しすることで、設定された発射レートの上限まで連続して弾丸を発射する。
        *   デフォルトの発射レートは1秒間に5発とする。
        *   特定の武器や強化により、この発射レートを無限大に設定することが可能で、その場合は長押しにより最速での連続発射が可能となる。
    *   **マウスカーソル**: ゲームウィンドウ内では、OSのデフォルトのマウスカーソルは非表示にする。

## 6. 技術スタック

*   **ゲームエンジン**: pyxel (Python)
*   **パッケージ管理**: uv

## 7. ゲームの状態 (Game States)

*   ゲームは以下のいずれかの状態を持つ。
    *   プレイ中 (In-Game)
    *   ゲームオーバー (Game Over)

### 7.1. ゲームオーバー状態 (Game Over State)

*   **遷移条件**:
    *   プレイヤーのHPが0になった瞬間に、ゲームオーバー状態に遷移する。
*   **状態中の挙動**:
    *   ゲームの更新 (敵の移動、弾の発射など) はすべて停止する。
    *   画面中央に「GAME OVER」の文字と、最終的な生存時間を表示する。
    *   リトライボタン (Rキー) またはタイトルに戻るボタン (Qキー) を表示する。
*   **状態からの遷移**:
    *   リトライボタン (Rキー) を押すと、ゲームが初期状態に戻り、プレイ中状態に遷移する。
    *   タイトルに戻るボタン (Qキー) を押すと、ゲームアプリケーションを終了する。